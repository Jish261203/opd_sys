{% extends 'base.html' %} {% block title %}Patients - OPD System{% endblock %}
{% block content %}
<div class="row mb-4">
  <div class="col-md-12">
    <div class="d-flex justify-content-between align-items-center">
      <h2>Patients</h2>
      <a href="/patients/create" class="btn btn-success">âž• Add New Patient</a>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-md-6">
    <form method="GET" action="/patients/" class="d-flex gap-2">
      <input
        type="text"
        name="search"
        class="form-control"
        placeholder="Search by name or phone..."
        value="{{ search_query }}"
      />
      <button type="submit" class="btn btn-primary">Search</button>
      {% if search_query %}
      <a href="/patients/" class="btn btn-secondary">Clear</a>
      {% endif %}
    </form>
  </div>
</div>

{% if patients %}
<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Gender</th>
              <th>Age</th>
              <th>Phone</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for patient in patients %}
            <tr>
              <td><strong>#{{ patient.id }}</strong></td>
              <td>{{ patient.name }}</td>
              <td>{{ patient.gender }}</td>
              <td>{{ patient.age }}</td>
              <td>{{ patient.phone }}</td>
              <td>
                {% if patient.status == 'Active' %}
                <span class="badge bg-success">{{ patient.status }}</span>
                {% else %}
                <span class="badge bg-danger">{{ patient.status }}</span>
                {% endif %}
              </td>
              <td>{{ patient.created_at.strftime('%Y-%m-%d') }}</td>
              <td>
                <a href="/patients/{{ patient.id }}" class="btn btn-sm btn-info"
                  >View</a
                >
                <a
                  href="/patients/{{ patient.id }}/edit"
                  class="btn btn-sm btn-warning"
                  >Edit</a
                >
                <a
                  href="/consultations/patient/{{ patient.id }}"
                  class="btn btn-sm btn-secondary"
                  >History</a
                >
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% else %}
<div class="alert alert-info" role="alert">
  {% if search_query %} No patients found matching "{{ search_query }}". {% else
  %} No patients registered yet.
  <a href="/patients/create">Create the first patient</a>. {% endif %}
</div>
{% endif %} {% endblock %}
